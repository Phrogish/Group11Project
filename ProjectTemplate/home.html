<!DOCTYPE html>
<html>
<head>
    <title>Employee Home</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body>

    <h1>Welcome Employee!</h1>

    <h2 id="pointsDisplay"></h2>
    <div id="userInfo"></div>

    <button onclick="logout()">Logout</button>

    <script>
        $(document).ready(function () {

            $.ajax({
                type: "POST",
                url: "ProjectServices.asmx/Me",
                data: "{}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",

                success: function (msg) {
                    let result = msg.d;

                    if (!result.loggedIn) {
                        window.location.href = "index.html";
                    }
                    else {
                        $("#userInfo").text("User ID: " + result.userId + " | Role: " + result.role);
                        loadPoints(); // load the points on the home page
                    }
                },

                error: function (e) {
                    console.log(e);
                    window.location.href = "index.html";
                }
            });

        });

        function loadPoints() {
            $.ajax({
                type: "POST",
                url: "ProjectServices.asmx/GetPoints",
                data: "{}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    let points = msg.d;
                    $("#pointsDisplay").text("⭐ Your Points: " + points);
                },
                error: function (e) {
                    console.log(e);
                    $("#pointsDisplay").text("Could not load points.");
                }
            });
        }

        function logout() {
            $.ajax({
                type: "POST",
                url: "ProjectServices.asmx/Logout",
                data: "{}",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function () {
                    window.location.href = "index.html";
                },
                error: function (e) {
                    console.log(e);
                    window.location.href = "index.html";
                }
            });
        }
    </script>

</body>
</html>